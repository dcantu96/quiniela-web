<%= render 'show_header' %>

<div class='p-6 container mx-auto'>
  <div id='recipients' class="p-8 mt-6 lg:mt-0 rounded shadow bg-white">
    <% cache do %>
      <table id="zero-config"
      data-controller="datatable"
      class="stripe hover w-full py-4"
      data-datatable-config="<%= { 
        responsive: true
      }.to_json %>">
        <thead>
          <tr>
            <th data-priority="1">Username</th>
            <th data-priority="2">Points</th>
            <% @matches.each_with_index do |match, index| %>
              <th data-priority="<%= index + 3 %>"><%= match.visit_team.short_name %> @ <%= match.home_team.short_name %></th>
            <% end %>
          </tr>
        </thead>
        <tbody>
          <% @membership_weeks.each do |membership_week| %>
            <tr>
              <td><%= membership_week.membership.account.username %></td>
              <td><%= membership_week.points%></td>
              <% if membership_week.membership.account.user == current_user %>
                <% membership_week.picks.joins(:match).order(start_time: :asc).each do |pick| %>
                  <td class='text-center'>
                    <%= pick.correct ? 'bien' : pick.picked_team.short_name if pick.picked_team %>
                  </td>
                <% end %>
              <% else %>
                <% membership_week.picks.joins(:match).order(start_time: :asc).each do |pick| %>
                  <td class='text-center'>
                    <% if pick.picked_team && Time.current > pick.match.show_time %>
                      <%= pick.correct ? 'bien' : pick.picked_team.short_name %>
                    <% end %>
                  </td>
                <% end %>
              <% end %>
            </tr>
          <% end %>
        </tbody>
        
      </table>
    <% end %>
  </div>
</div>